{"ast":null,"code":"var path = require('path');\n\nvar once = require('once');\n\nvar concat = require('concat-stream');\n\nvar octal = require('octal');\n\nvar stat = require('./stat');\n\nvar xtend = require('xtend');\n\nvar errno = require('./errno');\n\nvar ROOT = stat({\n  type: 'directory',\n  mode: octal(777),\n  size: 4096\n});\n\nvar normalize = function (key) {\n  key = key[0] === '/' ? key : '/' + key;\n  key = path.normalize(key);\n  if (key === '/') return key;\n  return key[key.length - 1] === '/' ? key.slice(0, -1) : key;\n};\n\nvar prefix = function (key) {\n  var depth = key.split('/').length.toString(36);\n  return '0000000000'.slice(depth.length) + depth + key;\n};\n\nmodule.exports = function (db) {\n  var that = {};\n  that.normalize = normalize;\n\n  that.get = function (key, cb) {\n    key = normalize(key);\n    if (key === '/') return process.nextTick(cb.bind(null, null, ROOT, '/'));\n    db.get(prefix(key), {\n      valueEncoding: 'json'\n    }, function (err, doc) {\n      if (err && err.notFound) return cb(errno.ENOENT(key), null, key);\n      if (err) return cb(err, null, key);\n      cb(null, stat(doc), key);\n    });\n  };\n\n  that.writable = function (key, cb) {\n    key = normalize(key);\n    if (key === '/') return process.nextTick(cb.bind(null, errno.EPERM(key)));\n    that.follow(path.dirname(key), function (err, parent) {\n      if (err) return cb(err);\n      if (!parent.isDirectory()) return cb(errno.ENOTDIR(key));\n      cb(null, key);\n    });\n  };\n\n  that.list = function (key, cb) {\n    key = normalize(key);\n    var start = prefix(key === '/' ? key : key + '/');\n    var keys = db.createKeyStream({\n      start: start,\n      end: start + '\\xff'\n    });\n    cb = once(cb);\n    keys.on('error', cb);\n    keys.pipe(concat({\n      encoding: 'object'\n    }, function (files) {\n      files = files.map(function (file) {\n        return file.split('/').pop();\n      });\n      cb(null, files);\n    }));\n  };\n\n  var resolve = function (dir, cb) {\n    var root = '/';\n    var parts = dir.split('/').slice(1);\n\n    var loop = function () {\n      that.get(path.join(root, parts.shift()), function (err, doc, key) {\n        if (err) return cb(err, doc, dir);\n        root = doc.target || key;\n        if (!parts.length) return cb(null, doc, key);\n        loop();\n      });\n    };\n\n    loop();\n  };\n\n  that.follow = function (key, cb) {\n    resolve(normalize(key), function loop(err, doc, key) {\n      if (err) return cb(err, null, key);\n      if (doc.target) return that.get(doc.target, loop);\n      cb(null, stat(doc), key);\n    });\n  };\n\n  that.update = function (key, opts, cb) {\n    that.get(key, function (err, doc, key) {\n      if (err) return cb(err);\n      if (key === '/') return cb(errno.EPERM(key));\n      that.put(key, xtend(doc, opts), cb);\n    });\n  };\n\n  that.put = function (key, opts, cb) {\n    that.writable(key, function (err, key) {\n      if (err) return cb(err);\n      db.put(prefix(key), stat(opts), {\n        valueEncoding: 'json'\n      }, cb);\n    });\n  };\n\n  that.del = function (key, cb) {\n    key = normalize(key);\n    if (key === '/') return process.nextTick(cb.bind(null, errno.EPERM(key)));\n    db.del(prefix(key), cb);\n  };\n\n  return that;\n};","map":{"version":3,"sources":["C:/Users/jdk17/Desktop/KingFisher/kingfisher-kayaking/node_modules/level-filesystem/paths.js"],"names":["path","require","once","concat","octal","stat","xtend","errno","ROOT","type","mode","size","normalize","key","length","slice","prefix","depth","split","toString","module","exports","db","that","get","cb","process","nextTick","bind","valueEncoding","err","doc","notFound","ENOENT","writable","EPERM","follow","dirname","parent","isDirectory","ENOTDIR","list","start","keys","createKeyStream","end","on","pipe","encoding","files","map","file","pop","resolve","dir","root","parts","loop","join","shift","target","update","opts","put","del"],"mappings":"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","sourcesContent":["var path = require('path');\nvar once = require('once');\nvar concat = require('concat-stream');\nvar octal = require('octal')\nvar stat = require('./stat');\nvar xtend = require('xtend');\nvar errno = require('./errno');\n\nvar ROOT = stat({\n\ttype: 'directory',\n\tmode: octal(777),\n\tsize: 4096\n});\n\nvar normalize = function(key) {\n\tkey = key[0] === '/' ? key : '/' + key;\n\tkey = path.normalize(key);\n\tif (key === '/') return key;\n\treturn key[key.length-1] === '/' ? key.slice(0, -1) : key;\n};\n\nvar prefix = function(key) {\n\tvar depth = key.split('/').length.toString(36);\n\treturn '0000000000'.slice(depth.length)+depth+key;\n};\n\nmodule.exports = function(db) {\n\tvar that = {};\n\n\tthat.normalize = normalize;\n\n\tthat.get = function(key, cb) {\n\t\tkey = normalize(key);\n\t\tif (key === '/') return process.nextTick(cb.bind(null, null, ROOT, '/'));\n\t\tdb.get(prefix(key), {valueEncoding:'json'}, function(err, doc) {\n\t\t\tif (err && err.notFound) return cb(errno.ENOENT(key), null, key);\n\t\t\tif (err) return cb(err, null, key);\n\t\t\tcb(null, stat(doc), key);\n\t\t});\n\t};\n\n\tthat.writable = function(key, cb) {\n\t\tkey = normalize(key);\n\t\tif (key === '/') return process.nextTick(cb.bind(null, errno.EPERM(key)));\n\t\tthat.follow(path.dirname(key), function(err, parent) {\n\t\t\tif (err) return cb(err);\n\t\t\tif (!parent.isDirectory()) return cb(errno.ENOTDIR(key));\n\t\t\tcb(null, key);\n\t\t});\n\t};\n\n\tthat.list = function(key, cb) {\n\t\tkey = normalize(key);\n\n\t\tvar start = prefix(key === '/' ? key : key + '/');\n\t\tvar keys = db.createKeyStream({start: start, end: start+'\\xff'});\n\n\t\tcb = once(cb);\n\n\t\tkeys.on('error', cb);\n\t\tkeys.pipe(concat({encoding:'object'}, function(files) {\n\t\t\tfiles = files.map(function(file) {\n\t\t\t\treturn file.split('/').pop();\n\t\t\t});\n\n\t\t\tcb(null, files);\n\t\t}));\n\t};\n\n\tvar resolve = function(dir, cb) {\n\t\tvar root = '/';\n\t\tvar parts = dir.split('/').slice(1);\n\n\t\tvar loop = function() {\n\t\t\tthat.get(path.join(root, parts.shift()), function(err, doc, key) {\n\t\t\t\tif (err) return cb(err, doc, dir);\n\t\t\t\troot = doc.target || key;\n\t\t\t\tif (!parts.length) return cb(null, doc, key);\n\t\t\t\tloop();\n\t\t\t});\n\t\t};\n\n\t\tloop();\n\t};\n\n\tthat.follow = function(key, cb) {\n\t\tresolve(normalize(key), function loop(err, doc, key) {\n\t\t\tif (err) return cb(err, null, key);\n\t\t\tif (doc.target) return that.get(doc.target, loop);\n\t\t\tcb(null, stat(doc), key);\n\t\t});\n\t};\n\n\tthat.update = function(key, opts, cb) {\n\t\tthat.get(key, function(err, doc, key) {\n\t\t\tif (err) return cb(err);\n\t\t\tif (key === '/') return cb(errno.EPERM(key));\n\t\t\tthat.put(key, xtend(doc, opts), cb);\n\t\t});\n\t};\n\n\tthat.put = function(key, opts, cb) {\n\t\tthat.writable(key, function(err, key) {\n\t\t\tif (err) return cb(err);\n\t\t\tdb.put(prefix(key), stat(opts), {valueEncoding:'json'}, cb);\n\t\t});\n\t};\n\n\tthat.del = function(key, cb) {\n\t\tkey = normalize(key);\n\t\tif (key === '/') return process.nextTick(cb.bind(null, errno.EPERM(key)));\n\t\tdb.del(prefix(key), cb);\n\t};\n\n\treturn that;\n};\n"]},"metadata":{},"sourceType":"script"}