{"ast":null,"code":"/* Copyright (c) 2012-2014 LevelUP contributors\n * See list at <https://github.com/rvagg/node-levelup#contributing>\n * MIT License\n * <https://github.com/rvagg/node-levelup/blob/master/LICENSE.md>\n */\nvar Stream = require('stream').Stream,\n    inherits = require('util').inherits,\n    extend = require('xtend'),\n    bl = require('bl'),\n    setImmediate = global.setImmediate || process.nextTick,\n    getOptions = require('./util').getOptions,\n    defaultOptions = {\n  type: 'put'\n};\n\nfunction WriteStream(options, db) {\n  if (!(this instanceof WriteStream)) return new WriteStream(options, db);\n  Stream.call(this);\n  this._options = extend(defaultOptions, getOptions(db, options));\n  this._db = db;\n  this._buffer = [];\n  this._status = 'init';\n  this._end = false;\n  this.writable = true;\n  this.readable = false;\n\n  var self = this,\n      ready = function () {\n    if (!self.writable) return;\n    self._status = 'ready';\n    self.emit('ready');\n\n    self._process();\n  };\n\n  if (db.isOpen()) setImmediate(ready);else db.once('ready', ready);\n}\n\ninherits(WriteStream, Stream);\n\nWriteStream.prototype.write = function (data) {\n  if (!this.writable) return false;\n\n  this._buffer.push(data);\n\n  if (this._status != 'init') this._processDelayed();\n\n  if (this._options.maxBufferLength && this._buffer.length > this._options.maxBufferLength) {\n    this._writeBlock = true;\n    return false;\n  }\n\n  return true;\n};\n\nWriteStream.prototype.end = function (data) {\n  var self = this;\n  if (data) this.write(data);\n  setImmediate(function () {\n    self._end = true;\n\n    self._process();\n  });\n};\n\nWriteStream.prototype.destroy = function () {\n  this.writable = false;\n  this.end();\n};\n\nWriteStream.prototype.destroySoon = function () {\n  this.end();\n};\n\nWriteStream.prototype.add = function (entry) {\n  if (!entry.props) return;\n  if (entry.props.Directory) entry.pipe(this._db.writeStream(this._options));else if (entry.props.File || entry.File || entry.type == 'File') this._write(entry);\n  return true;\n};\n\nWriteStream.prototype._processDelayed = function () {\n  var self = this;\n  setImmediate(function () {\n    self._process();\n  });\n};\n\nWriteStream.prototype._process = function () {\n  var buffer,\n      self = this,\n      cb = function (err) {\n    if (!self.writable) return;\n    if (self._status != 'closed') self._status = 'ready';\n\n    if (err) {\n      self.writable = false;\n      return self.emit('error', err);\n    }\n\n    self._process();\n  };\n\n  if (self._status != 'ready' && self.writable) {\n    if (self._buffer.length && self._status != 'closed') self._processDelayed();\n    return;\n  }\n\n  if (self._buffer.length && self.writable) {\n    self._status = 'writing';\n    buffer = self._buffer;\n    self._buffer = [];\n\n    self._db.batch(buffer.map(function (d) {\n      return {\n        type: d.type || self._options.type,\n        key: d.key,\n        value: d.value,\n        keyEncoding: d.keyEncoding || self._options.keyEncoding,\n        valueEncoding: d.valueEncoding || d.encoding || self._options.valueEncoding\n      };\n    }), cb);\n\n    if (self._writeBlock) {\n      self._writeBlock = false;\n      self.emit('drain');\n    } // don't allow close until callback has returned\n\n\n    return;\n  }\n\n  if (self._end && self._status != 'closed') {\n    self._status = 'closed';\n    self.writable = false;\n    self.emit('close');\n  }\n};\n\nWriteStream.prototype._write = function (entry) {\n  var key = entry.path || entry.props.path,\n      self = this;\n  if (!key) return;\n  entry.pipe(bl(function (err, data) {\n    if (err) {\n      self.writable = false;\n      return self.emit('error', err);\n    }\n\n    if (self._options.fstreamRoot && key.indexOf(self._options.fstreamRoot) > -1) key = key.substr(self._options.fstreamRoot.length + 1);\n    self.write({\n      key: key,\n      value: data.slice(0)\n    });\n  }));\n};\n\nWriteStream.prototype.toString = function () {\n  return 'LevelUP.WriteStream';\n};\n\nmodule.exports = WriteStream;","map":{"version":3,"sources":["C:/Users/jdk17/Desktop/KingFisher/kingfisher-kayaking/node_modules/levelup/lib/write-stream.js"],"names":["Stream","require","inherits","extend","bl","setImmediate","global","process","nextTick","getOptions","defaultOptions","type","WriteStream","options","db","call","_options","_db","_buffer","_status","_end","writable","readable","self","ready","emit","_process","isOpen","once","prototype","write","data","push","_processDelayed","maxBufferLength","length","_writeBlock","end","destroy","destroySoon","add","entry","props","Directory","pipe","writeStream","File","_write","buffer","cb","err","batch","map","d","key","value","keyEncoding","valueEncoding","encoding","path","fstreamRoot","indexOf","substr","slice","toString","module","exports"],"mappings":"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","sourcesContent":["/* Copyright (c) 2012-2014 LevelUP contributors\n * See list at <https://github.com/rvagg/node-levelup#contributing>\n * MIT License\n * <https://github.com/rvagg/node-levelup/blob/master/LICENSE.md>\n */\n\nvar Stream       = require('stream').Stream\n  , inherits     = require('util').inherits\n  , extend       = require('xtend')\n  , bl           = require('bl')\n\n  , setImmediate = global.setImmediate || process.nextTick\n\n  , getOptions   = require('./util').getOptions\n\n  , defaultOptions = { type: 'put' }\n\nfunction WriteStream (options, db) {\n  if (!(this instanceof WriteStream))\n    return new WriteStream(options, db)\n\n  Stream.call(this)\n  this._options = extend(defaultOptions, getOptions(db, options))\n  this._db      = db\n  this._buffer  = []\n  this._status  = 'init'\n  this._end     = false\n  this.writable = true\n  this.readable = false\n\n  var self = this\n    , ready = function () {\n        if (!self.writable)\n          return\n        self._status = 'ready'\n        self.emit('ready')\n        self._process()\n      }\n\n  if (db.isOpen())\n    setImmediate(ready)\n  else\n    db.once('ready', ready)\n}\n\ninherits(WriteStream, Stream)\n\nWriteStream.prototype.write = function (data) {\n  if (!this.writable)\n    return false\n  this._buffer.push(data)\n  if (this._status != 'init')\n    this._processDelayed()\n  if (this._options.maxBufferLength &&\n      this._buffer.length > this._options.maxBufferLength) {\n    this._writeBlock = true\n    return false\n  }\n  return true\n}\n\nWriteStream.prototype.end = function (data) {\n  var self = this\n  if (data)\n    this.write(data)\n  setImmediate(function () {\n    self._end = true\n    self._process()\n  })\n}\n\nWriteStream.prototype.destroy = function () {\n  this.writable = false\n  this.end()\n}\n\nWriteStream.prototype.destroySoon = function () {\n  this.end()\n}\n\nWriteStream.prototype.add = function (entry) {\n  if (!entry.props)\n    return\n  if (entry.props.Directory)\n    entry.pipe(this._db.writeStream(this._options))\n  else if (entry.props.File || entry.File || entry.type == 'File')\n    this._write(entry)\n  return true\n}\n\nWriteStream.prototype._processDelayed = function () {\n  var self = this\n  setImmediate(function () {\n    self._process()\n  })\n}\n\nWriteStream.prototype._process = function () {\n  var buffer\n    , self = this\n\n    , cb = function (err) {\n        if (!self.writable)\n          return\n        if (self._status != 'closed')\n          self._status = 'ready'\n        if (err) {\n          self.writable = false\n          return self.emit('error', err)\n        }\n        self._process()\n      }\n\n  if (self._status != 'ready' && self.writable) {\n    if (self._buffer.length && self._status != 'closed')\n      self._processDelayed()\n    return\n  }\n\n  if (self._buffer.length && self.writable) {\n    self._status = 'writing'\n    buffer       = self._buffer\n    self._buffer = []\n\n    self._db.batch(buffer.map(function (d) {\n      return {\n          type          : d.type || self._options.type\n        , key           : d.key\n        , value         : d.value\n        , keyEncoding   : d.keyEncoding || self._options.keyEncoding\n        , valueEncoding : d.valueEncoding\n            || d.encoding\n            || self._options.valueEncoding\n      }\n    }), cb)\n\n    if (self._writeBlock) {\n      self._writeBlock = false\n      self.emit('drain')\n    }\n\n    // don't allow close until callback has returned\n    return\n  }\n\n  if (self._end && self._status != 'closed') {\n    self._status  = 'closed'\n    self.writable = false\n    self.emit('close')\n  }\n}\n\nWriteStream.prototype._write = function (entry) {\n  var key = entry.path || entry.props.path\n    , self = this\n\n  if (!key)\n    return\n\n  entry.pipe(bl(function (err, data) {\n    if (err) {\n      self.writable = false\n      return self.emit('error', err)\n    }\n\n    if (self._options.fstreamRoot &&\n        key.indexOf(self._options.fstreamRoot) > -1)\n      key = key.substr(self._options.fstreamRoot.length + 1)\n\n    self.write({ key: key, value: data.slice(0) })\n  }))\n}\n\nWriteStream.prototype.toString = function () {\n  return 'LevelUP.WriteStream'\n}\n\nmodule.exports = WriteStream\n"]},"metadata":{},"sourceType":"script"}