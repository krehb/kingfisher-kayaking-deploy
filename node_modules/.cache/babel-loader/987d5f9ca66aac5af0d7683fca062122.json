{"ast":null,"code":"var fwd = require('fwd-stream');\n\nvar sublevel = require('level-sublevel');\n\nvar blobs = require('level-blobs');\n\nvar peek = require('level-peek');\n\nvar once = require('once');\n\nvar octal = require('octal');\n\nvar errno = require('./errno');\n\nvar paths = require('./paths');\n\nvar watchers = require('./watchers');\n\nvar nextTick = function (cb, err, val) {\n  process.nextTick(function () {\n    cb(err, val);\n  });\n};\n\nvar noop = function () {};\n\nmodule.exports = function (db, opts) {\n  var fs = {};\n  db = sublevel(db);\n  var bl = blobs(db.sublevel('blobs'), opts);\n  var ps = paths(db.sublevel('stats'));\n  var links = db.sublevel('links');\n  var listeners = watchers();\n  var fds = [];\n  var now = Date.now();\n\n  var inc = function () {\n    return ++now;\n  };\n\n  fs.mkdir = function (key, mode, cb) {\n    if (typeof mode === 'function') return fs.mkdir(key, null, mode);\n    if (!mode) mode = octal(777);\n    if (!cb) cb = noop;\n    ps.follow(key, function (err, stat, key) {\n      if (err && err.code !== 'ENOENT') return cb(err);\n      if (stat) return cb(errno.EEXIST(key));\n      ps.put(key, {\n        type: 'directory',\n        mode: mode,\n        size: 4096\n      }, listeners.cb(key, cb));\n    });\n  };\n\n  fs.rmdir = function (key, cb) {\n    if (!cb) cb = noop;\n    ps.follow(key, function (err, stat, key) {\n      if (err) return cb(err);\n      fs.readdir(key, function (err, files) {\n        if (err) return cb(err);\n        if (files.length) return cb(errno.ENOTEMPTY(key));\n        ps.del(key, listeners.cb(key, cb));\n      });\n    });\n  };\n\n  fs.readdir = function (key, cb) {\n    ps.follow(key, function (err, stat, key) {\n      if (err) return cb(err);\n      if (!stat) return cb(errno.ENOENT(key));\n      if (!stat.isDirectory()) return cb(errno.ENOTDIR(key));\n      ps.list(key, cb);\n    });\n  };\n\n  var stat = function (key, lookup, cb) {\n    lookup(key, function (err, stat, key) {\n      if (err) return cb(err);\n      if (!stat.isFile()) return cb(null, stat);\n      var blob = stat && stat.blob || key;\n      bl.size(blob, function (err, size) {\n        if (err) return cb(err);\n        stat.size = size;\n        cb(null, stat);\n      });\n    });\n  };\n\n  fs.stat = function (key, cb) {\n    stat(key, ps.follow, cb);\n  };\n\n  fs.lstat = function (key, cb) {\n    stat(key, ps.get, cb);\n  };\n\n  fs.exists = function (key, cb) {\n    ps.follow(key, function (err) {\n      cb(!err);\n    });\n  };\n\n  var chmod = function (key, lookup, mode, cb) {\n    if (!cb) cb = noop;\n    lookup(key, function (err, stat, key) {\n      if (err) return cb(err);\n      ps.update(key, {\n        mode: mode\n      }, listeners.cb(key, cb));\n    });\n  };\n\n  fs.chmod = function (key, mode, cb) {\n    chmod(key, ps.follow, mode, cb);\n  };\n\n  fs.lchmod = function (key, mode, cb) {\n    chmod(key, ps.get, mode, cb);\n  };\n\n  var chown = function (key, lookup, uid, gid, cb) {\n    if (!cb) cb = noop;\n    lookup(key, function (err, stat, key) {\n      if (err) return cb(err);\n      ps.update(key, {\n        uid: uid,\n        gid: gid\n      }, listeners.cb(key, cb));\n    });\n  };\n\n  fs.chown = function (key, uid, gid, cb) {\n    chown(key, ps.follow, uid, gid, cb);\n  };\n\n  fs.lchown = function (key, uid, gid, cb) {\n    chown(key, ps.get, uid, gid, cb);\n  };\n\n  fs.utimes = function (key, atime, mtime, cb) {\n    if (!cb) cb = noop;\n    ps.follow(key, function (err, stat, key) {\n      if (err) return cb(err);\n      var upd = {};\n      if (atime) upd.atime = atime;\n      if (mtime) upd.mtime = mtime;\n      ps.update(key, upd, listeners.cb(key, cb));\n    });\n  };\n\n  fs.rename = function (from, to, cb) {\n    if (!cb) cb = noop;\n    ps.follow(from, function (err, statFrom, from) {\n      if (err) return cb(err);\n\n      var rename = function () {\n        cb = listeners.cb(to, listeners.cb(from, cb));\n        ps.put(to, statFrom, function (err) {\n          if (err) return cb(err);\n          ps.del(from, cb);\n        });\n      };\n\n      ps.follow(to, function (err, statTo, to) {\n        if (err && err.code !== 'ENOENT') return cb(err);\n        if (!statTo) return rename();\n        if (statFrom.isDirectory() !== statTo.isDirectory()) return cb(errno.EISDIR(from));\n\n        if (statTo.isDirectory()) {\n          fs.readdir(to, function (err, list) {\n            if (err) return cb(err);\n            if (list.length) return cb(errno.ENOTEMPTY(from));\n            rename();\n          });\n          return;\n        }\n\n        rename();\n      });\n    });\n  };\n\n  fs.realpath = function (key, cache, cb) {\n    if (typeof cache === 'function') return fs.realpath(key, null, cache);\n    ps.follow(key, function (err, stat, key) {\n      if (err) return cb(err);\n      cb(null, key);\n    });\n  };\n\n  fs.writeFile = function (key, data, opts, cb) {\n    if (typeof opts === 'function') return fs.writeFile(key, data, null, opts);\n    if (typeof opts === 'string') opts = {\n      encoding: opts\n    };\n    if (!opts) opts = {};\n    if (!cb) cb = noop;\n    if (!Buffer.isBuffer(data)) data = new Buffer(data, opts.encoding || 'utf-8');\n    var flags = opts.flags || 'w';\n    opts.append = flags[0] !== 'w';\n    ps.follow(key, function (err, stat, key) {\n      if (err && err.code !== 'ENOENT') return cb(err);\n      if (stat && stat.isDirectory()) return cb(errno.EISDIR(key));\n      if (stat && flags[1] === 'x') return cb(errno.EEXIST(key));\n      var blob = stat && stat.blob || key;\n      ps.writable(key, function (err) {\n        if (err) return cb(err);\n        bl.write(blob, data, opts, function (err) {\n          if (err) return cb(err);\n          ps.put(key, {\n            ctime: stat && stat.ctime,\n            mtime: new Date(),\n            mode: opts.mode || octal(666),\n            type: 'file'\n          }, listeners.cb(key, cb));\n        });\n      });\n    });\n  };\n\n  fs.appendFile = function (key, data, opts, cb) {\n    if (typeof opts === 'function') return fs.appendFile(key, data, null, opts);\n    if (typeof opts === 'string') opts = {\n      encoding: opts\n    };\n    if (!opts) opts = {};\n    opts.flags = 'a';\n    fs.writeFile(key, data, opts, cb);\n  };\n\n  fs.unlink = function (key, cb) {\n    if (!cb) cb = noop;\n    ps.get(key, function (err, stat, key) {\n      if (err) return cb(err);\n      if (stat.isDirectory()) return cb(errno.EISDIR(key));\n\n      var clean = function (target) {\n        peek(links, {\n          start: target + '\\xff',\n          end: target + '\\xff\\xff'\n        }, function (err) {\n          if (err) return bl.remove(target, cb); // no more links\n\n          cb();\n        });\n      };\n\n      var onlink = function () {\n        var target = stat.link.slice(0, stat.link.indexOf('\\xff'));\n        links.del(stat.link, function (err) {\n          if (err) return cb(err);\n          clean(target);\n        });\n      };\n\n      ps.del(key, listeners.cb(key, function (err) {\n        if (err) return cb(err);\n        if (stat.link) return onlink();\n        links.del(key + '\\xff', function (err) {\n          if (err) return cb(err);\n          clean(key);\n        });\n      }));\n    });\n  };\n\n  fs.readFile = function (key, opts, cb) {\n    if (typeof opts === 'function') return fs.readFile(key, null, opts);\n    if (typeof opts === 'string') opts = {\n      encoding: opts\n    };\n    if (!opts) opts = {};\n    var encoding = opts.encoding || 'binary';\n    var flag = opts.flag || 'r';\n    ps.follow(key, function (err, stat, key) {\n      if (err) return cb(err);\n      if (stat.isDirectory()) return cb(errno.EISDIR(key));\n      var blob = stat && stat.blob || key;\n      bl.read(blob, function (err, data) {\n        if (err) return cb(err);\n        cb(null, opts.encoding ? data.toString(opts.encoding) : data);\n      });\n    });\n  };\n\n  fs.createReadStream = function (key, opts) {\n    if (!opts) opts = {};\n    var closed = false;\n    var rs = fwd.readable(function (cb) {\n      ps.follow(key, function (err, stat, key) {\n        if (err) return cb(err);\n        if (stat.isDirectory()) return cb(errno.EISDIR(key));\n        var blob = stat && stat.blob || key;\n        var r = bl.createReadStream(blob, opts);\n        rs.emit('open');\n        r.on('end', function () {\n          process.nextTick(function () {\n            if (!closed) rs.emit('close');\n          });\n        });\n        cb(null, r);\n      });\n    });\n    rs.on('close', function () {\n      closed = true;\n    });\n    return rs;\n  };\n\n  fs.createWriteStream = function (key, opts) {\n    if (!opts) opts = {};\n    var flags = opts.flags || 'w';\n    var closed = false;\n    var mode = opts.mode || octal(666);\n    opts.append = flags[0] === 'a';\n    var ws = fwd.writable(function (cb) {\n      ps.follow(key, function (err, stat, key) {\n        if (err && err.code !== 'ENOENT') return cb(err);\n        if (stat && stat.isDirectory()) return cb(errno.EISDIR(key));\n        if (stat && flags[1] === 'x') return cb(errno.EEXIST(key));\n        var blob = stat && stat.blob || key;\n        ps.writable(blob, function (err) {\n          if (err) return cb(err);\n          var ctime = stat ? stat.ctime : new Date();\n          var s = {\n            ctime: ctime,\n            mtime: new Date(),\n            mode: mode,\n            type: 'file'\n          };\n          ps.put(key, s, function (err) {\n            if (err) return cb(err);\n            var w = bl.createWriteStream(blob, opts);\n            ws.emit('open');\n            w.on('finish', function () {\n              s.mtime = new Date();\n              ps.put(key, s, function () {\n                listeners.change(key);\n                if (!closed) ws.emit('close');\n              });\n            });\n            cb(null, w);\n          });\n        });\n      });\n    });\n    ws.on('close', function () {\n      closed = true;\n    });\n    return ws;\n  };\n\n  fs.truncate = function (key, len, cb) {\n    ps.follow(key, function (err, stat, key) {\n      if (err) return cb(err);\n      var blob = stat && stat.blob || key;\n      bl.size(blob, function (err, size) {\n        if (err) return cb(err);\n        ps.writable(key, function (err) {\n          if (err) return cb(err);\n          cb = once(listeners.cb(key, cb));\n          if (!len) return bl.remove(blob, cb);\n          var ws = bl.createWriteStream(blob, {\n            start: size < len ? len - 1 : len\n          });\n          ws.on('error', cb);\n          ws.on('finish', cb);\n          if (size < len) ws.write(new Buffer([0]));\n          ws.end();\n        });\n      });\n    });\n  };\n\n  fs.watchFile = function (key, opts, cb) {\n    if (typeof opts === 'function') return fs.watchFile(key, null, opts);\n    return listeners.watch(ps.normalize(key), cb);\n  };\n\n  fs.unwatchFile = function (key, cb) {\n    listeners.unwatch(ps.normalize(key), cb);\n  };\n\n  fs.watch = function (key, opts, cb) {\n    if (typeof opts === 'function') return fs.watch(key, null, opts);\n    return listeners.watcher(ps.normalize(key), cb);\n  };\n\n  fs.notify = function (cb) {\n    listeners.on('change', cb);\n  };\n\n  fs.open = function (key, flags, mode, cb) {\n    if (typeof mode === 'function') return fs.open(key, flags, null, mode);\n    ps.follow(key, function (err, stat, key) {\n      if (err && err.code !== 'ENOENT') return cb(err);\n      var fl = flags[0];\n      var plus = flags[1] === '+' || flags[2] === '+';\n      var blob = stat && stat.blob || key;\n      var f = {\n        key: key,\n        blob: blob,\n        mode: mode || octal(666),\n        readable: fl === 'r' || (fl === 'w' || fl === 'a') && plus,\n        writable: fl === 'w' || fl === 'a' || fl === 'r' && plus,\n        append: fl === 'a'\n      };\n      if (fl === 'r' && err) return cb(err);\n      if (flags[1] === 'x' && stat) return cb(errno.EEXIST(key));\n      if (stat && stat.isDirectory()) return cb(errno.EISDIR(key));\n      bl.size(blob, function (err, size) {\n        if (err) return cb(err);\n        if (f.append) f.writePos = size;\n        ps.writable(key, function (err) {\n          if (err) return cb(err);\n\n          var onready = function (err) {\n            if (err) return cb(err);\n            var i = fds.indexOf(null);\n            if (i === -1) i = 10 + fds.push(fds.length + 10) - 1;\n            f.fd = i;\n            fds[i] = f;\n            listeners.change(key);\n            cb(null, f.fd);\n          };\n\n          var ontruncate = function (err) {\n            if (err) return cb(err);\n            if (stat) return onready();\n            ps.put(blob, {\n              ctime: stat && stat.ctime,\n              type: 'file'\n            }, onready);\n          };\n\n          if (!f.append && f.writable) return bl.remove(blob, ontruncate);\n          ontruncate();\n        });\n      });\n    });\n  };\n\n  fs.close = function (fd, cb) {\n    var f = fds[fd];\n    if (!f) return nextTick(cb, errno.EBADF());\n    fds[fd] = null;\n    nextTick(listeners.cb(f.key, cb));\n  };\n\n  fs.write = function (fd, buf, off, len, pos, cb) {\n    var f = fds[fd];\n    if (!cb) cb = noop;\n    if (!f || !f.writable) return nextTick(cb, errno.EBADF());\n    if (pos === null) pos = f.writePos || 0;\n    var slice = buf.slice(off, off + len);\n    f.writePos = pos + slice.length;\n    bl.write(f.blob, slice, {\n      start: pos,\n      append: true\n    }, function (err) {\n      if (err) return cb(err);\n      cb(null, len, buf);\n    });\n  };\n\n  fs.read = function (fd, buf, off, len, pos, cb) {\n    var f = fds[fd];\n    if (!cb) cb = noop;\n    if (!f || !f.readable) return nextTick(cb, errno.EBADF());\n    if (pos === null) pos = fs.readPos || 0;\n    bl.read(f.blob, {\n      start: pos,\n      end: pos + len - 1\n    }, function (err, read) {\n      if (err) return cb(err);\n      var slice = read.slice(0, len);\n      slice.copy(buf, off);\n      fs.readPos = pos + slice.length;\n      cb(null, slice.length, buf);\n    });\n  };\n\n  fs.fsync = function (fd, cb) {\n    var f = fds[fd];\n    if (!cb) cb = noop;\n    if (!f || !f.writable) return nextTick(cb, errno.EBADF());\n    nextTick(cb);\n  };\n\n  fs.ftruncate = function (fd, len, cb) {\n    var f = fds[fd];\n    if (!cb) cb = noop;\n    if (!f) return nextTick(cb, errno.EBADF());\n    fs.truncate(f.blob, len, cb);\n  };\n\n  fs.fchown = function (fd, uid, gid, cb) {\n    var f = fds[fd];\n    if (!cb) cb = noop;\n    if (!f) return nextTick(cb, errno.EBADF());\n    fs.chown(f.key, uid, gid, cb);\n  };\n\n  fs.fchmod = function (fd, mode, cb) {\n    var f = fds[fd];\n    if (!cb) cb = noop;\n    if (!f) return nextTick(cb, errno.EBADF());\n    fs.chmod(f.key, mode, cb);\n  };\n\n  fs.futimes = function (fd, atime, mtime, cb) {\n    var f = fds[fd];\n    if (!cb) cb = noop;\n    if (!f) return nextTick(cb, errno.EBADF());\n    fs.utimes(f.key, atime, mtime, cb);\n  };\n\n  fs.fstat = function (fd, cb) {\n    var f = fds[fd];\n    if (!f) return nextTick(cb, errno.EBADF());\n    fs.stat(f.key, cb);\n  };\n\n  fs.symlink = function (target, name, cb) {\n    if (!cb) cb = noop;\n    ps.follow(target, function (err, stat, target) {\n      if (err) return cb(err);\n      ps.get(name, function (err, stat) {\n        if (err && err.code !== 'ENOENT') return cb(err);\n        if (stat) return cb(errno.EEXIST(name));\n        ps.put(name, {\n          type: 'symlink',\n          target: target,\n          mode: octal(777)\n        }, cb);\n      });\n    });\n  };\n\n  fs.readlink = function (key, cb) {\n    ps.get(key, function (err, stat) {\n      if (err) return cb(err);\n      if (!stat.target) return cb(errno.EINVAL(key));\n      cb(null, stat.target);\n    });\n  };\n\n  fs.link = function (target, name, cb) {\n    if (!cb) cb = noop;\n    ps.follow(target, function (err, stat, target) {\n      if (err) return cb(err);\n      if (!stat.isFile()) return cb(errno.EINVAL(target));\n      ps.get(name, function (err, st) {\n        if (err && err.code !== 'ENOENT') return cb(err);\n        if (st) return cb(errno.EEXIST(name));\n        var link = target + '\\xff' + inc();\n        links.put(target + '\\xff', target, function (err) {\n          if (err) return cb(err);\n          links.put(link, target, function (err) {\n            if (err) return cb(err);\n            ps.put(name, {\n              type: 'file',\n              link: link,\n              blob: target,\n              mode: stat.mode\n            }, cb);\n          });\n        });\n      });\n    });\n  };\n\n  return fs;\n};","map":{"version":3,"sources":["C:/Users/jdk17/Desktop/KingFisher/kingfisher-kayaking/node_modules/level-filesystem/index.js"],"names":["fwd","require","sublevel","blobs","peek","once","octal","errno","paths","watchers","nextTick","cb","err","val","process","noop","module","exports","db","opts","fs","bl","ps","links","listeners","fds","now","Date","inc","mkdir","key","mode","follow","stat","code","EEXIST","put","type","size","rmdir","readdir","files","length","ENOTEMPTY","del","ENOENT","isDirectory","ENOTDIR","list","lookup","isFile","blob","lstat","get","exists","chmod","update","lchmod","chown","uid","gid","lchown","utimes","atime","mtime","upd","rename","from","to","statFrom","statTo","EISDIR","realpath","cache","writeFile","data","encoding","Buffer","isBuffer","flags","append","writable","write","ctime","appendFile","unlink","clean","target","start","end","remove","onlink","link","slice","indexOf","readFile","flag","read","toString","createReadStream","closed","rs","readable","r","emit","on","createWriteStream","ws","s","w","change","truncate","len","watchFile","watch","normalize","unwatchFile","unwatch","watcher","notify","open","fl","plus","f","writePos","onready","i","push","fd","ontruncate","close","EBADF","buf","off","pos","readPos","copy","fsync","ftruncate","fchown","fchmod","futimes","fstat","symlink","name","readlink","EINVAL","st"],"mappings":"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","sourcesContent":["var fwd = require('fwd-stream');\nvar sublevel = require('level-sublevel');\nvar blobs = require('level-blobs');\nvar peek = require('level-peek');\nvar once = require('once');\nvar octal = require('octal')\nvar errno = require('./errno');\nvar paths = require('./paths');\nvar watchers = require('./watchers');\n\nvar nextTick = function(cb, err, val) {\n\tprocess.nextTick(function() {\n\t\tcb(err, val);\n\t});\n};\n\nvar noop = function() {};\n\nmodule.exports = function(db, opts) {\n\tvar fs = {};\n\n\tdb = sublevel(db);\n\n\tvar bl = blobs(db.sublevel('blobs'), opts);\n\tvar ps = paths(db.sublevel('stats'));\n\tvar links = db.sublevel('links');\n\n\tvar listeners = watchers();\n\tvar fds = [];\n\n\tvar now = Date.now();\n\tvar inc = function() {\n\t\treturn ++now;\n\t};\n\n\tfs.mkdir = function(key, mode, cb) {\n\t\tif (typeof mode === 'function') return fs.mkdir(key, null, mode);\n\t\tif (!mode) mode = octal(777);\n\t\tif (!cb) cb = noop;\n\n\t\tps.follow(key, function(err, stat, key) {\n\t\t\tif (err && err.code !== 'ENOENT') return cb(err);\n\t\t\tif (stat) return cb(errno.EEXIST(key));\n\n\t\t\tps.put(key, {\n\t\t\t\ttype:'directory',\n\t\t\t\tmode: mode,\n\t\t\t\tsize: 4096\n\t\t\t}, listeners.cb(key, cb));\n\t\t});\n\t};\n\n\tfs.rmdir = function(key, cb) {\n\t\tif (!cb) cb = noop;\n\t\tps.follow(key, function(err, stat, key) {\n\t\t\tif (err) return cb(err);\n\t\t\tfs.readdir(key, function(err, files) {\n\t\t\t\tif (err) return cb(err);\n\t\t\t\tif (files.length) return cb(errno.ENOTEMPTY(key));\n\t\t\t\tps.del(key, listeners.cb(key, cb));\n\t\t\t});\n\t\t});\n\n\t};\n\n\tfs.readdir = function(key, cb) {\n\t\tps.follow(key, function(err, stat, key) {\n\t\t\tif (err) return cb(err);\n\t\t\tif (!stat) return cb(errno.ENOENT(key));\n\t\t\tif (!stat.isDirectory()) return cb(errno.ENOTDIR(key));\n\t\t\tps.list(key, cb);\n\t\t});\n\t};\n\n\tvar stat = function(key, lookup, cb) {\n\t\tlookup(key, function(err, stat, key) {\n\t\t\tif (err) return cb(err);\n\t\t\tif (!stat.isFile()) return cb(null, stat);\n\t\t\tvar blob = stat && stat.blob || key;\n\t\t\tbl.size(blob, function(err, size) {\n\t\t\t\tif (err) return cb(err);\n\t\t\t\tstat.size = size;\n\t\t\t\tcb(null, stat);\n\t\t\t});\n\t\t});\n\t};\n\n\tfs.stat = function(key, cb) {\n\t\tstat(key, ps.follow, cb);\n\t};\n\n\tfs.lstat = function(key, cb) {\n\t\tstat(key, ps.get, cb);\n\t};\n\n\tfs.exists = function(key, cb) {\n\t\tps.follow(key, function(err) {\n\t\t\tcb(!err);\n\t\t});\n\t};\n\n\tvar chmod = function(key, lookup, mode, cb) {\n\t\tif (!cb) cb = noop;\n\t\tlookup(key, function(err, stat, key) {\n\t\t\tif (err) return cb(err);\n\t\t\tps.update(key, {mode:mode}, listeners.cb(key, cb));\n\t\t});\n\t};\n\n\tfs.chmod = function(key, mode, cb) {\n\t\tchmod(key, ps.follow, mode, cb);\n\t};\n\n\tfs.lchmod = function(key, mode, cb) {\n\t\tchmod(key, ps.get, mode, cb);\n\t};\n\n\tvar chown = function(key, lookup, uid, gid, cb) {\n\t\tif (!cb) cb = noop;\n\t\tlookup(key, function(err, stat, key) {\n\t\t\tif (err) return cb(err);\n\t\t\tps.update(key, {uid:uid, gid:gid}, listeners.cb(key, cb));\n\t\t});\n\t};\n\n\tfs.chown = function(key, uid, gid, cb) {\n\t\tchown(key, ps.follow, uid, gid, cb);\n\t};\n\n\tfs.lchown = function(key, uid, gid, cb) {\n\t\tchown(key, ps.get, uid, gid, cb);\n\t};\n\n\tfs.utimes = function(key, atime, mtime, cb) {\n\t\tif (!cb) cb = noop;\n\t\tps.follow(key, function(err, stat, key) {\n\t\t\tif (err) return cb(err);\n\t\t\tvar upd = {};\n\t\t\tif (atime) upd.atime = atime;\n\t\t\tif (mtime) upd.mtime = mtime;\n\t\t\tps.update(key, upd, listeners.cb(key, cb));\n\t\t});\n\t};\n\n\tfs.rename = function(from, to, cb) {\n\t\tif (!cb) cb = noop;\n\n\t\tps.follow(from, function(err, statFrom, from) {\n\t\t\tif (err) return cb(err);\n\n\t\t\tvar rename = function() {\n\t\t\t\tcb = listeners.cb(to, listeners.cb(from, cb));\n\t\t\t\tps.put(to, statFrom, function(err) {\n\t\t\t\t\tif (err) return cb(err);\n\t\t\t\t\tps.del(from, cb);\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tps.follow(to, function(err, statTo, to) {\n\t\t\t\tif (err && err.code !== 'ENOENT') return cb(err);\n\t\t\t\tif (!statTo) return rename();\n\t\t\t\tif (statFrom.isDirectory() !== statTo.isDirectory()) return cb(errno.EISDIR(from));\n\n\t\t\t\tif (statTo.isDirectory()) {\n\t\t\t\t\tfs.readdir(to, function(err, list) {\n\t\t\t\t\t\tif (err) return cb(err);\n\t\t\t\t\t\tif (list.length) return cb(errno.ENOTEMPTY(from));\n\t\t\t\t\t\trename();\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\trename();\n\t\t\t});\n\t\t});\n\t};\n\n\tfs.realpath = function(key, cache, cb) {\n\t\tif (typeof cache === 'function') return fs.realpath(key, null, cache);\n\t\tps.follow(key, function(err, stat, key) {\n\t\t\tif (err) return cb(err);\n\t\t\tcb(null, key);\n\t\t});\n\t};\n\n\tfs.writeFile = function(key, data, opts, cb) {\n\t\tif (typeof opts === 'function') return fs.writeFile(key, data, null, opts);\n\t\tif (typeof opts === 'string') opts = {encoding:opts};\n\t\tif (!opts) opts = {};\n\t\tif (!cb) cb = noop;\n\n\t\tif (!Buffer.isBuffer(data)) data = new Buffer(data, opts.encoding || 'utf-8');\n\n\t\tvar flags = opts.flags || 'w';\n\t\topts.append = flags[0] !== 'w';\n\n\t\tps.follow(key, function(err, stat, key) {\n\t\t\tif (err && err.code !== 'ENOENT') return cb(err);\n\t\t\tif (stat && stat.isDirectory()) return cb(errno.EISDIR(key));\n\t\t\tif (stat && flags[1] === 'x') return cb(errno.EEXIST(key));\n\n\t\t\tvar blob = stat && stat.blob || key;\n\t\t\tps.writable(key, function(err) {\n\t\t\t\tif (err) return cb(err);\n\n\t\t\t\tbl.write(blob, data, opts, function(err) {\n\t\t\t\t\tif (err) return cb(err);\n\n\t\t\t\t\tps.put(key, {\n\t\t\t\t\t\tctime: stat && stat.ctime,\n\t\t\t\t\t\tmtime: new Date(),\n\t\t\t\t\t\tmode: opts.mode || octal(666),\n\t\t\t\t\t\ttype:'file'\n\t\t\t\t\t}, listeners.cb(key, cb));\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n\tfs.appendFile = function(key, data, opts, cb) {\n\t\tif (typeof opts === 'function') return fs.appendFile(key, data, null, opts);\n\t\tif (typeof opts === 'string') opts = {encoding:opts};\n\t\tif (!opts) opts = {};\n\n\t\topts.flags = 'a';\n\t\tfs.writeFile(key, data, opts, cb);\n\t};\n\n\tfs.unlink = function(key, cb) {\n\t\tif (!cb) cb = noop;\n\n\t\tps.get(key, function(err, stat, key) {\n\t\t\tif (err) return cb(err);\n\t\t\tif (stat.isDirectory()) return cb(errno.EISDIR(key));\n\n\t\t\tvar clean = function(target) {\n\t\t\t\tpeek(links, {start:target+'\\xff', end:target+'\\xff\\xff'}, function(err) {\n\t\t\t\t\tif (err) return bl.remove(target, cb); // no more links\n\t\t\t\t\tcb();\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tvar onlink = function() {\n\t\t\t\tvar target = stat.link.slice(0, stat.link.indexOf('\\xff'));\n\t\t\t\tlinks.del(stat.link, function(err) {\n\t\t\t\t\tif (err) return cb(err);\n\t\t\t\t\tclean(target);\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tps.del(key, listeners.cb(key, function(err) {\n\t\t\t\tif (err) return cb(err);\n\t\t\t\tif (stat.link) return onlink();\n\t\t\t\tlinks.del(key+'\\xff', function(err) {\n\t\t\t\t\tif (err) return cb(err);\n\t\t\t\t\tclean(key);\n\t\t\t\t});\n\t\t\t}));\n\t\t});\n\t};\n\n\tfs.readFile = function(key, opts, cb) {\n\t\tif (typeof opts === 'function') return fs.readFile(key, null, opts);\n\t\tif (typeof opts === 'string') opts = {encoding:opts};\n\t\tif (!opts) opts = {};\n\n\t\tvar encoding = opts.encoding || 'binary';\n\t\tvar flag = opts.flag || 'r';\n\n\t\tps.follow(key, function(err, stat, key) {\n\t\t\tif (err) return cb(err);\n\t\t\tif (stat.isDirectory()) return cb(errno.EISDIR(key));\n\n\t\t\tvar blob = stat && stat.blob || key;\n\t\t\tbl.read(blob, function(err, data) {\n\t\t\t\tif (err) return cb(err);\n\t\t\t\tcb(null, opts.encoding ? data.toString(opts.encoding) : data);\n\t\t\t});\n\t\t});\n\t};\n\n\tfs.createReadStream = function(key, opts) {\n\t\tif (!opts) opts = {};\n\n\t\tvar closed = false;\n\t\tvar rs = fwd.readable(function(cb) {\n\t\t\tps.follow(key, function(err, stat, key) {\n\t\t\t\tif (err) return cb(err);\n\t\t\t\tif (stat.isDirectory()) return cb(errno.EISDIR(key));\n\n\t\t\t\tvar blob = stat && stat.blob || key;\n\t\t\t\tvar r = bl.createReadStream(blob, opts);\n\n\t\t\t\trs.emit('open');\n\t\t\t\tr.on('end', function() {\n\t\t\t\t\tprocess.nextTick(function() {\n\t\t\t\t\t\tif (!closed) rs.emit('close');\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tcb(null, r);\n\t\t\t});\n\t\t});\n\n\t\trs.on('close', function() {\n\t\t\tclosed = true;\n\t\t});\n\n\t\treturn rs;\n\t};\n\n\tfs.createWriteStream = function(key, opts) {\n\t\tif (!opts) opts = {};\n\n\t\tvar flags = opts.flags || 'w';\n\t\tvar closed = false;\n\t\tvar mode = opts.mode || octal(666);\n\n\t\topts.append = flags[0] === 'a';\n\n\t\tvar ws = fwd.writable(function(cb) {\n\t\t\tps.follow(key, function(err, stat, key) {\n\t\t\t\tif (err && err.code !== 'ENOENT') return cb(err);\n\t\t\t\tif (stat && stat.isDirectory()) return cb(errno.EISDIR(key));\n\t\t\t\tif (stat && flags[1] === 'x') return cb(errno.EEXIST(key));\n\n\t\t\t\tvar blob = stat && stat.blob || key;\n\t\t\t\tps.writable(blob, function(err) {\n\t\t\t\t\tif (err) return cb(err);\n\n\t\t\t\t\tvar ctime = stat ? stat.ctime : new Date();\n\t\t\t\t\tvar s = {\n\t\t\t\t\t\tctime: ctime,\n\t\t\t\t\t\tmtime: new Date(),\n\t\t\t\t\t\tmode: mode,\n\t\t\t\t\t\ttype:'file'\n\t\t\t\t\t};\n\n\t\t\t\t\tps.put(key, s, function(err) {\n\t\t\t\t\t\tif (err) return cb(err);\n\n\t\t\t\t\t\tvar w = bl.createWriteStream(blob, opts);\n\n\t\t\t\t\t\tws.emit('open');\n\t\t\t\t\t\tw.on('finish', function() {\n\t\t\t\t\t\t\ts.mtime = new Date();\n\t\t\t\t\t\t\tps.put(key, s, function() {\n\t\t\t\t\t\t\t\tlisteners.change(key);\n\t\t\t\t\t\t\t\tif (!closed) ws.emit('close');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tcb(null, w);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tws.on('close', function() {\n\t\t\tclosed = true;\n\t\t});\n\n\t\treturn ws;\n\t};\n\n\tfs.truncate = function(key, len, cb) {\n\t\tps.follow(key, function(err, stat, key) {\n\t\t\tif (err) return cb(err);\n\n\t\t\tvar blob = stat && stat.blob || key;\n\t\t\tbl.size(blob, function(err, size) {\n\t\t\t\tif (err) return cb(err);\n\n\t\t\t\tps.writable(key, function(err) {\n\t\t\t\t\tif (err) return cb(err);\n\n\t\t\t\t\tcb = once(listeners.cb(key, cb));\n\t\t\t\t\tif (!len) return bl.remove(blob, cb);\n\n\t\t\t\t\tvar ws = bl.createWriteStream(blob, {\n\t\t\t\t\t\tstart:size < len ? len-1 : len\n\t\t\t\t\t});\n\n\t\t\t\t\tws.on('error', cb);\n\t\t\t\t\tws.on('finish', cb);\n\n\t\t\t\t\tif (size < len) ws.write(new Buffer([0]));\n\t\t\t\t\tws.end();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n\tfs.watchFile = function(key, opts, cb) {\n\t\tif (typeof opts === 'function') return fs.watchFile(key, null, opts);\n\t\treturn listeners.watch(ps.normalize(key), cb);\n\t};\n\n\tfs.unwatchFile = function(key, cb) {\n\t\tlisteners.unwatch(ps.normalize(key), cb);\n\t};\n\n\tfs.watch = function(key, opts, cb) {\n\t\tif (typeof opts === 'function') return fs.watch(key, null, opts)\n\t\treturn listeners.watcher(ps.normalize(key), cb);\n\t};\n\n\tfs.notify = function(cb) {\n\t\tlisteners.on('change', cb)\n\t}\n\n\tfs.open = function(key, flags, mode, cb) {\n\t\tif (typeof mode === 'function') return fs.open(key, flags, null, mode);\n\n\t\tps.follow(key, function(err, stat, key) {\n\t\t\tif (err && err.code !== 'ENOENT') return cb(err);\n\n\t\t\tvar fl = flags[0];\n\t\t\tvar plus = flags[1] === '+' || flags[2] === '+';\n\t\t\tvar blob = stat && stat.blob || key;\n\n\t\t\tvar f = {\n\t\t\t\tkey: key,\n\t\t\t\tblob: blob,\n\t\t\t\tmode: mode || octal(666),\n\t\t\t\treadable: fl === 'r' || ((fl === 'w' || fl === 'a') && plus),\n\t\t\t\twritable: fl === 'w' || fl === 'a' || (fl === 'r' && plus),\n\t\t\t\tappend: fl === 'a'\n\t\t\t};\n\n\t\t\tif (fl === 'r' && err) return cb(err);\n\t\t\tif (flags[1] === 'x' && stat) return cb(errno.EEXIST(key));\n\t\t\tif (stat && stat.isDirectory()) return cb(errno.EISDIR(key));\n\n\t\t\tbl.size(blob, function(err, size) {\n\t\t\t\tif (err) return cb(err);\n\n\t\t\t\tif (f.append) f.writePos = size;\n\n\t\t\t\tps.writable(key, function(err) {\n\t\t\t\t\tif (err) return cb(err);\n\n\t\t\t\t\tvar onready = function(err) {\n\t\t\t\t\t\tif (err) return cb(err);\n\n\t\t\t\t\t\tvar i = fds.indexOf(null);\n\t\t\t\t\t\tif (i === -1) i = 10+fds.push(fds.length+10)-1;\n\n\t\t\t\t\t\tf.fd = i;\n\t\t\t\t\t\tfds[i] = f;\n\t\t\t\t\t\tlisteners.change(key);\n\n\t\t\t\t\t\tcb(null, f.fd);\n\t\t\t\t\t};\n\n\t\t\t\t\tvar ontruncate = function(err) {\n\t\t\t\t\t\tif (err) return cb(err);\n\t\t\t\t\t\tif (stat) return onready();\n\t\t\t\t\t\tps.put(blob, {ctime:stat && stat.ctime, type:'file'}, onready);\n\t\t\t\t\t};\n\n\t\t\t\t\tif (!f.append && f.writable) return bl.remove(blob, ontruncate);\n\t\t\t\t\tontruncate();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n\tfs.close = function(fd, cb) {\n\t\tvar f = fds[fd];\n\t\tif (!f) return nextTick(cb, errno.EBADF());\n\n\t\tfds[fd] = null;\n\t\tnextTick(listeners.cb(f.key, cb));\n\t};\n\n\tfs.write = function(fd, buf, off, len, pos, cb) {\n\t\tvar f = fds[fd];\n\t\tif (!cb) cb = noop;\n\t\tif (!f || !f.writable) return nextTick(cb, errno.EBADF());\n\n\t\tif (pos === null) pos = f.writePos || 0;\n\n\t\tvar slice = buf.slice(off, off+len);\n\t\tf.writePos = pos + slice.length;\n\n\t\tbl.write(f.blob, slice, {start:pos, append:true}, function(err) {\n\t\t\tif (err) return cb(err);\n\t\t\tcb(null, len, buf);\n\t\t});\n\t};\n\n\tfs.read = function(fd, buf, off, len, pos, cb) {\n\t\tvar f = fds[fd];\n\t\tif (!cb) cb = noop;\n\t\tif (!f || !f.readable) return nextTick(cb, errno.EBADF());\n\n\t\tif (pos === null) pos = fs.readPos || 0;\n\n\t\tbl.read(f.blob, {start:pos, end:pos+len-1}, function(err, read) {\n\t\t\tif (err) return cb(err);\n\t\t\tvar slice = read.slice(0, len);\n\t\t\tslice.copy(buf, off);\n\t\t\tfs.readPos = pos+slice.length;\n\t\t\tcb(null, slice.length, buf);\n\t\t});\n\t};\n\n\tfs.fsync = function(fd, cb) {\n\t\tvar f = fds[fd];\n\t\tif (!cb) cb = noop;\n\t\tif (!f || !f.writable) return nextTick(cb, errno.EBADF());\n\n\t\tnextTick(cb);\n\t};\n\n\tfs.ftruncate = function(fd, len, cb) {\n\t\tvar f = fds[fd];\n\t\tif (!cb) cb = noop;\n\t\tif (!f) return nextTick(cb, errno.EBADF());\n\n\t\tfs.truncate(f.blob, len, cb);\n\t};\n\n\tfs.fchown = function(fd, uid, gid, cb) {\n\t\tvar f = fds[fd];\n\t\tif (!cb) cb = noop;\n\t\tif (!f) return nextTick(cb, errno.EBADF());\n\n\t\tfs.chown(f.key, uid, gid, cb);\n\t};\n\n\tfs.fchmod = function(fd, mode, cb) {\n\t\tvar f = fds[fd];\n\t\tif (!cb) cb = noop;\n\t\tif (!f) return nextTick(cb, errno.EBADF());\n\n\t\tfs.chmod(f.key, mode, cb);\n\t};\n\n\tfs.futimes = function(fd, atime, mtime, cb) {\n\t\tvar f = fds[fd];\n\t\tif (!cb) cb = noop;\n\t\tif (!f) return nextTick(cb, errno.EBADF());\n\n\t\tfs.utimes(f.key, atime, mtime, cb);\n\t};\n\n\tfs.fstat = function(fd, cb) {\n\t\tvar f = fds[fd];\n\t\tif (!f) return nextTick(cb, errno.EBADF());\n\n\t\tfs.stat(f.key, cb);\n\t};\n\n\tfs.symlink = function(target, name, cb) {\n\t\tif (!cb) cb = noop;\n\t\tps.follow(target, function(err, stat, target) {\n\t\t\tif (err) return cb(err);\n\t\t\tps.get(name, function(err, stat) {\n\t\t\t\tif (err && err.code !== 'ENOENT') return cb(err);\n\t\t\t\tif (stat) return cb(errno.EEXIST(name));\n\t\t\t\tps.put(name, {type:'symlink', target:target, mode:octal(777)}, cb);\n\t\t\t});\n\t\t});\n\t};\n\n\tfs.readlink = function(key, cb) {\n\t\tps.get(key, function(err, stat) {\n\t\t\tif (err) return cb(err);\n\t\t\tif (!stat.target) return cb(errno.EINVAL(key));\n\t\t\tcb(null, stat.target);\n\t\t});\n\t};\n\n\tfs.link = function(target, name, cb) {\n\t\tif (!cb) cb = noop;\n\t\tps.follow(target, function(err, stat, target) {\n\t\t\tif (err) return cb(err);\n\t\t\tif (!stat.isFile()) return cb(errno.EINVAL(target));\n\t\t\tps.get(name, function(err, st) {\n\t\t\t\tif (err && err.code !== 'ENOENT') return cb(err);\n\t\t\t\tif (st) return cb(errno.EEXIST(name));\n\t\t\t\tvar link = target+'\\xff'+inc();\n\t\t\t\tlinks.put(target+'\\xff', target, function(err) {\n\t\t\t\t\tif (err) return cb(err);\n\t\t\t\t\tlinks.put(link, target, function(err) {\n\t\t\t\t\t\tif (err) return cb(err);\n\t\t\t\t\t\tps.put(name, {type:'file', link:link, blob:target, mode:stat.mode}, cb);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n\treturn fs;\n};\n"]},"metadata":{},"sourceType":"script"}