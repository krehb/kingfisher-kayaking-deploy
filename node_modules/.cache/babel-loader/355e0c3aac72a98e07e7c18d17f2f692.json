{"ast":null,"code":"var EventEmitter = require('events').EventEmitter;\n\nvar inherits = require('util').inherits;\n\nvar ranges = require('string-range');\n\nvar fixRange = require('level-fix-range');\n\nvar xtend = require('xtend');\n\nvar Batch = require('./batch');\n\ninherits(SubDB, EventEmitter);\n\nfunction SubDB(db, prefix, options) {\n  if ('string' === typeof options) {\n    console.error('db.sublevel(name, seperator<string>) is depreciated');\n    console.error('use db.sublevel(name, {sep: separator})) if you must');\n    options = {\n      sep: options\n    };\n  }\n\n  if (!(this instanceof SubDB)) return new SubDB(db, prefix, options);\n  if (!db) throw new Error('must provide db');\n  if (!prefix) throw new Error('must provide prefix');\n  options = options || {};\n  options.sep = options.sep || '\\xff';\n  this._parent = db;\n  this._options = options;\n  this.options = options;\n  this._prefix = prefix;\n  this._root = root(this);\n  db.sublevels[prefix] = this;\n  this.sublevels = {};\n  this.methods = {};\n  var self = this;\n  this.hooks = {\n    pre: function () {\n      return self.pre.apply(self, arguments);\n    },\n    post: function () {\n      return self.post.apply(self, arguments);\n    }\n  };\n}\n\nvar SDB = SubDB.prototype;\n\nSDB._key = function (key) {\n  var sep = this._options.sep;\n  return sep + this._prefix + sep + key;\n};\n\nSDB._getOptsAndCb = function (opts, cb) {\n  if (typeof opts == 'function') {\n    cb = opts;\n    opts = {};\n  }\n\n  return {\n    opts: xtend(opts, this._options),\n    cb: cb\n  };\n};\n\nSDB.sublevel = function (prefix, options) {\n  if (this.sublevels[prefix]) return this.sublevels[prefix];\n  return new SubDB(this, prefix, options || this._options);\n};\n\nSDB.put = function (key, value, opts, cb) {\n  var res = this._getOptsAndCb(opts, cb);\n\n  this._root.put(this.prefix(key), value, res.opts, res.cb);\n};\n\nSDB.get = function (key, opts, cb) {\n  var res = this._getOptsAndCb(opts, cb);\n\n  this._root.get(this.prefix(key), res.opts, res.cb);\n};\n\nSDB.del = function (key, opts, cb) {\n  var res = this._getOptsAndCb(opts, cb);\n\n  this._root.del(this.prefix(key), res.opts, res.cb);\n};\n\nSDB.batch = function (changes, opts, cb) {\n  if (!Array.isArray(changes)) return new Batch(this);\n\n  var self = this,\n      res = this._getOptsAndCb(opts, cb);\n\n  changes.forEach(function (ch) {\n    //OH YEAH, WE NEED TO VALIDATE THAT UPDATING THIS KEY/PREFIX IS ALLOWED\n    if ('string' === typeof ch.prefix) ch.key = ch.prefix + ch.key;else ch.key = (ch.prefix || self).prefix(ch.key);\n    if (ch.prefix) ch.prefix = null;\n  });\n\n  this._root.batch(changes, res.opts, res.cb);\n};\n\nSDB._getKeyEncoding = function () {\n  if (this.options.keyEncoding) return this.options.keyEncoding;\n  if (this._parent && this._parent._getKeyEncoding) return this._parent._getKeyEncoding();\n};\n\nSDB._getValueEncoding = function () {\n  if (this.options.valueEncoding) return this.options.valueEncoding;\n  if (this._parent && this._parent._getValueEncoding) return this._parent._getValueEncoding();\n};\n\nSDB.prefix = function (key) {\n  var sep = this._options.sep;\n  return this._parent.prefix() + sep + this._prefix + sep + (key || '');\n};\n\nSDB.keyStream = SDB.createKeyStream = function (opts) {\n  opts = opts || {};\n  opts.keys = true;\n  opts.values = false;\n  return this.createReadStream(opts);\n};\n\nSDB.valueStream = SDB.createValueStream = function (opts) {\n  opts = opts || {};\n  opts.keys = false;\n  opts.values = true;\n  opts.keys = false;\n  return this.createReadStream(opts);\n};\n\nfunction selectivelyMerge(_opts, opts) {\n  ['valueEncoding', 'encoding', 'keyEncoding', 'reverse', 'values', 'keys', 'limit', 'fillCache'].forEach(function (k) {\n    if (opts.hasOwnProperty(k)) _opts[k] = opts[k];\n  });\n}\n\nSDB.readStream = SDB.createReadStream = function (opts) {\n  opts = opts || {};\n  var r = root(this);\n  var p = this.prefix();\n\n  var _opts = ranges.prefix(opts, p);\n\n  selectivelyMerge(_opts, xtend(opts, this._options));\n  var s = r.createReadStream(_opts);\n\n  if (_opts.values === false) {\n    var read = s.read;\n\n    if (read) {\n      s.read = function (size) {\n        var val = read.call(this, size);\n        if (val) val = val.substring(p.length);\n        return val;\n      };\n    } else {\n      var emit = s.emit;\n\n      s.emit = function (event, val) {\n        if (event === 'data') {\n          emit.call(this, 'data', val.substring(p.length));\n        } else emit.call(this, event, val);\n      };\n    }\n\n    return s;\n  } else if (_opts.keys === false) return s;else {\n    var read = s.read;\n\n    if (read) {\n      s.read = function (size) {\n        var d = read.call(this, size);\n        if (d) d.key = d.key.substring(p.length);\n        return d;\n      };\n    } else {\n      s.on('data', function (d) {\n        //mutate the prefix!\n        //this doesn't work for createKeyStream admittedly.\n        d.key = d.key.substring(p.length);\n      });\n    }\n\n    return s;\n  }\n};\n\nSDB.writeStream = SDB.createWriteStream = function () {\n  var r = root(this);\n  var p = this.prefix();\n  var ws = r.createWriteStream.apply(r, arguments);\n  var write = ws.write;\n  var encoding = this._options.encoding;\n  var valueEncoding = this._options.valueEncoding;\n  var keyEncoding = this._options.keyEncoding; // slight optimization, if no encoding was specified at all,\n  // which will be the case most times, make write not check at all\n\n  var nocheck = !encoding && !valueEncoding && !keyEncoding;\n  ws.write = nocheck ? function (data) {\n    data.key = p + data.key;\n    return write.call(ws, data);\n  } : function (data) {\n    data.key = p + data.key; // not merging all options here since this happens on every write and things could get slowed down\n    // at this point we only consider encoding important to propagate\n\n    if (encoding && typeof data.encoding === 'undefined') data.encoding = encoding;\n    if (valueEncoding && typeof data.valueEncoding === 'undefined') data.valueEncoding = valueEncoding;\n    if (keyEncoding && typeof data.keyEncoding === 'undefined') data.keyEncoding = keyEncoding;\n    return write.call(ws, data);\n  };\n  return ws;\n};\n\nSDB.approximateSize = function () {\n  var r = root(db);\n  return r.approximateSize.apply(r, arguments);\n};\n\nfunction root(db) {\n  if (!db._parent) return db;\n  return root(db._parent);\n}\n\nSDB.pre = function (range, hook) {\n  if (!hook) hook = range, range = null;\n  range = ranges.prefix(range, this.prefix(), this._options.sep);\n  var r = root(this._parent);\n  var p = this.prefix();\n  return r.hooks.pre(fixRange(range), function (ch, add, batch) {\n    hook({\n      key: ch.key.substring(p.length),\n      value: ch.value,\n      type: ch.type\n    }, function (ch, _p) {\n      //maybe remove the second add arg now\n      //that op can have prefix?\n      add(ch, ch.prefix ? _p : _p || p);\n    }, batch);\n  });\n};\n\nSDB.post = function (range, hook) {\n  if (!hook) hook = range, range = null;\n  var r = root(this._parent);\n  var p = this.prefix();\n  range = ranges.prefix(range, p, this._options.sep);\n  return r.hooks.post(fixRange(range), function (data) {\n    hook({\n      key: data.key.substring(p.length),\n      value: data.value,\n      type: data.type\n    });\n  });\n};\n\nvar exports = module.exports = SubDB;","map":{"version":3,"sources":["C:/Users/jdk17/Desktop/KingFisher/kingfisher-kayaking/node_modules/level-sublevel/sub.js"],"names":["EventEmitter","require","inherits","ranges","fixRange","xtend","Batch","SubDB","db","prefix","options","console","error","sep","Error","_parent","_options","_prefix","_root","root","sublevels","methods","self","hooks","pre","apply","arguments","post","SDB","prototype","_key","key","_getOptsAndCb","opts","cb","sublevel","put","value","res","get","del","batch","changes","Array","isArray","forEach","ch","_getKeyEncoding","keyEncoding","_getValueEncoding","valueEncoding","keyStream","createKeyStream","keys","values","createReadStream","valueStream","createValueStream","selectivelyMerge","_opts","k","hasOwnProperty","readStream","r","p","s","read","size","val","call","substring","length","emit","event","d","on","writeStream","createWriteStream","ws","write","encoding","nocheck","data","approximateSize","range","hook","add","type","_p","exports","module"],"mappings":"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","sourcesContent":["var EventEmitter = require('events').EventEmitter\nvar inherits     = require('util').inherits\nvar ranges       = require('string-range')\nvar fixRange     = require('level-fix-range')\nvar xtend        = require('xtend')\nvar Batch        = require('./batch')\n\ninherits(SubDB, EventEmitter)\n\nfunction SubDB (db, prefix, options) {\n  if('string' === typeof options) {\n    console.error('db.sublevel(name, seperator<string>) is depreciated')\n    console.error('use db.sublevel(name, {sep: separator})) if you must')\n    options = {sep: options}\n  }\n  if(!(this instanceof SubDB)) return new SubDB(db, prefix, options)\n  if(!db)     throw new Error('must provide db')\n  if(!prefix) throw new Error('must provide prefix')\n\n  options = options || {}\n  options.sep = options.sep || '\\xff'\n\n  this._parent = db\n  this._options = options\n  this.options = options\n  this._prefix = prefix\n  this._root = root(this)\n  db.sublevels[prefix] = this\n  this.sublevels = {}\n  this.methods = {}\n  var self = this\n  this.hooks = {\n    pre: function () {\n      return self.pre.apply(self, arguments)\n    },\n    post: function () {\n      return self.post.apply(self, arguments)\n    }\n  }\n}\n\nvar SDB = SubDB.prototype\n\nSDB._key = function (key) {\n  var sep = this._options.sep\n  return sep\n    + this._prefix\n    + sep\n    + key\n}\n\nSDB._getOptsAndCb = function (opts, cb) {\n  if (typeof opts == 'function') {\n    cb = opts\n    opts = {}\n  }\n  return { opts: xtend(opts, this._options), cb: cb }\n}\n\nSDB.sublevel = function (prefix, options) {\n  if(this.sublevels[prefix])\n    return this.sublevels[prefix]\n  return new SubDB(this, prefix, options || this._options)\n}\n\nSDB.put = function (key, value, opts, cb) {\n  var res = this._getOptsAndCb(opts, cb)\n  this._root.put(this.prefix(key), value, res.opts, res.cb)\n}\n\nSDB.get = function (key, opts, cb) {\n  var res = this._getOptsAndCb(opts, cb)\n  this._root.get(this.prefix(key), res.opts, res.cb)\n}\n\nSDB.del = function (key, opts, cb) {\n  var res = this._getOptsAndCb(opts, cb)\n  this._root.del(this.prefix(key), res.opts, res.cb)\n}\n\nSDB.batch = function (changes, opts, cb) {\n  if(!Array.isArray(changes))\n    return new Batch(this)\n  var self = this,\n      res = this._getOptsAndCb(opts, cb)\n  changes.forEach(function (ch) {\n\n    //OH YEAH, WE NEED TO VALIDATE THAT UPDATING THIS KEY/PREFIX IS ALLOWED\n    if('string' === typeof ch.prefix)\n      ch.key = ch.prefix + ch.key\n    else\n      ch.key = (ch.prefix || self).prefix(ch.key)\n\n    if(ch.prefix) ch.prefix = null\n  })\n  this._root.batch(changes, res.opts, res.cb)\n}\n\nSDB._getKeyEncoding = function () {\n  if(this.options.keyEncoding)\n    return this.options.keyEncoding\n  if(this._parent && this._parent._getKeyEncoding)\n    return this._parent._getKeyEncoding()\n}\n\nSDB._getValueEncoding = function () {\n  if(this.options.valueEncoding)\n    return this.options.valueEncoding\n  if(this._parent && this._parent._getValueEncoding)\n    return this._parent._getValueEncoding()\n}\n\nSDB.prefix = function (key) {\n  var sep = this._options.sep\n  return this._parent.prefix() + sep + this._prefix + sep + (key || '')\n}\n\nSDB.keyStream =\nSDB.createKeyStream = function (opts) {\n  opts = opts || {}\n  opts.keys = true\n  opts.values = false\n  return this.createReadStream(opts)\n}\n\nSDB.valueStream =\nSDB.createValueStream = function (opts) {\n  opts = opts || {}\n  opts.keys = false\n  opts.values = true\n  opts.keys = false\n  return this.createReadStream(opts)\n}\n\nfunction selectivelyMerge(_opts, opts) {\n  [ 'valueEncoding'\n  , 'encoding'\n  , 'keyEncoding'\n  , 'reverse'\n  , 'values'\n  , 'keys'\n  , 'limit'\n  , 'fillCache'\n  ]\n  .forEach(function (k) {\n    if (opts.hasOwnProperty(k)) _opts[k] = opts[k]\n  })\n}\n\nSDB.readStream =\nSDB.createReadStream = function (opts) {\n  opts = opts || {}\n  var r = root(this)\n  var p = this.prefix()\n\n  var _opts = ranges.prefix(opts, p)\n  selectivelyMerge(_opts, xtend(opts, this._options))\n\n  var s = r.createReadStream(_opts)\n\n  if(_opts.values === false) {\n    var read = s.read\n    if (read) {\n      s.read = function (size) {\n        var val = read.call(this, size)\n        if (val) val = val.substring(p.length)\n        return val\n      }\n    } else {\n      var emit = s.emit\n      s.emit = function (event, val) {\n        if(event === 'data') {\n          emit.call(this, 'data', val.substring(p.length))\n        } else\n          emit.call(this, event, val)\n      }\n    }\n    return s\n  } else if(_opts.keys === false)\n    return s\n  else {\n    var read = s.read\n    if (read) {\n      s.read = function (size) {\n        var d = read.call(this, size)\n        if (d) d.key = d.key.substring(p.length)\n        return d\n      }\n    } else {\n      s.on('data', function (d) {\n        //mutate the prefix!\n        //this doesn't work for createKeyStream admittedly.\n        d.key = d.key.substring(p.length)\n      })\n    }\n    return s\n  }\n}\n\n\nSDB.writeStream =\nSDB.createWriteStream = function () {\n  var r = root(this)\n  var p = this.prefix()\n  var ws = r.createWriteStream.apply(r, arguments)\n  var write = ws.write\n\n  var encoding = this._options.encoding\n  var valueEncoding = this._options.valueEncoding\n  var keyEncoding = this._options.keyEncoding\n\n  // slight optimization, if no encoding was specified at all,\n  // which will be the case most times, make write not check at all\n  var nocheck = !encoding && !valueEncoding && !keyEncoding\n\n  ws.write = nocheck\n    ? function (data) {\n        data.key = p + data.key\n        return write.call(ws, data)\n      }\n    : function (data) {\n        data.key = p + data.key\n\n        // not merging all options here since this happens on every write and things could get slowed down\n        // at this point we only consider encoding important to propagate\n        if (encoding && typeof data.encoding === 'undefined')\n          data.encoding = encoding\n        if (valueEncoding && typeof data.valueEncoding === 'undefined')\n          data.valueEncoding = valueEncoding\n        if (keyEncoding && typeof data.keyEncoding === 'undefined')\n          data.keyEncoding = keyEncoding\n\n        return write.call(ws, data)\n      }\n  return ws\n}\n\nSDB.approximateSize = function () {\n  var r = root(db)\n  return r.approximateSize.apply(r, arguments)\n}\n\nfunction root(db) {\n  if(!db._parent) return db\n  return root(db._parent)\n}\n\nSDB.pre = function (range, hook) {\n  if(!hook) hook = range, range = null\n  range = ranges.prefix(range, this.prefix(), this._options.sep)\n  var r = root(this._parent)\n  var p = this.prefix()\n  return r.hooks.pre(fixRange(range), function (ch, add, batch) {\n    hook({\n      key: ch.key.substring(p.length),\n      value: ch.value,\n      type: ch.type\n    }, function (ch, _p) {\n      //maybe remove the second add arg now\n      //that op can have prefix?\n      add(ch, ch.prefix ? _p : (_p || p))\n    }, batch)\n  })\n}\n\nSDB.post = function (range, hook) {\n  if(!hook) hook = range, range = null\n  var r = root(this._parent)\n  var p = this.prefix()\n  range = ranges.prefix(range, p, this._options.sep)\n  return r.hooks.post(fixRange(range), function (data) {\n    hook({key: data.key.substring(p.length), value: data.value, type: data.type})\n  })\n}\n\nvar exports = module.exports = SubDB\n\n"]},"metadata":{},"sourceType":"script"}